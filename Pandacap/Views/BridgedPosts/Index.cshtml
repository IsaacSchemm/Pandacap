@using Pandacap.Data
@model BridgedPostViewModel

@{
    ViewBag.Title = Model.Deviation.Title;
}

<h1>@Model.Deviation.Title</h1>

@if (Model.Deviation is UserArtworkDeviation artwork)
{
    <p>
        <img src="@artwork.ImageUrl"
             alt="@artwork.AltText"
             title="@artwork.AltText"
             style="width: 100%; max-width: 640px; max-height: 640px; object-fit: contain" />
    </p>

    @if (User.Identity?.IsAuthenticated == true)
    {
        <div class="card mb-3" style="max-width: 800px">
            <div class="card-header">
                Properties
            </div>
            <div class="card-body">
                <form asp-action="SetAltText">
                    <input type="hidden" name="id" value="@artwork.Id" />
                    <div class="mb-3">
                        <label for="alt" class="form-label">
                            Alt text
                        </label>
                        <input type="text" class="form-control" id="alt" name="alt" value="@artwork.AltText" />
                    </div>
                    <button type="submit" class="btn btn-primary">
                        Save
                    </button>
                </form>
            </div>
        </div>
    }
}

<p>
    @Html.Raw(Model.Deviation.Description)
</p>

@if (Model.Deviation.Tags.Any())
{
    <p>
        @foreach (string tag in Model.Deviation.Tags)
        {
            <a href="/Profile/Search?q=%23@(Uri.EscapeDataString(tag))">#@tag</a>
        }
    </p>
}

@if (Model.RemoteActivities.Any())
{
    foreach (var group in Model.RemoteActivities.GroupBy(a => a.ActivityType))
    {
        <details>
            <summary>
                @(group.Key)s: <strong>@group.Count()</strong>
            </summary>
            <ul>
                @foreach (var activity in group)
                {
                    <li>
                        <a href="@activity.ActorId" target="_blank">@activity.ActorId</a>
                        <span class="text-muted">(@activity.AddedAt)</span>
                    </li>
                }
            </ul>
        </details>
    }
}
